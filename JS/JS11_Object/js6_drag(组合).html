<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
<style>
div {
	position: absolute;
	width: 100px;
	height: 100px;
}
#box1 {
	top: 0;
	left: 0;
	background-color: #00BFFF;
}
#box2 {
	top: 0;
	left: 100px;
	background-color: green;
}
#box3 {
	top: 0;
	left: 200px;
	background-color: blue;
}
#box4 {
	top: 0;
	left: 300px;
	background-color: pink;
}
</style>
</head>
<body>
	<div id="box1"></div>
	<div id="box2"></div>
	<div id="box3"></div>
	<div id="box4"></div>
</body>
<script>
(function(){
	function Drag(id) {
		this.obj = document.getElementById(id);
		this.disX = 0;
		this.disY = 0;
		this.W = document.documentElement.clientWidth || document.body.clientWidth;
		this.H = document.documentElement.clientHeight || document.body.clientHeight;
		this.settings = {
			fnDown: function () {},
			fnUp: function () {}
		};
	}
	Drag.prototype = {
		constructor: this,
		init: function(opt) {
			var that = this;
			extend(this.settings,opt);//重置默认参数
			this.obj.addEventListener('mousedown',function(ev){
				var ev = ev || event;
				that.down(ev)
				ev.preventDefault();
			})
		},
		down: function (ev) {
			var that = this;
			this.disX = ev.pageX - this.obj.offsetLeft;
			this.disY = ev.pageY - this.obj.offsetTop;
			
			this.settings.fnDown();
			document.addEventListener('mousemove',fnMove);
			function fnMove(ev) {
				var ev = ev || event;
				that.move(ev);
			}
			document.addEventListener('mouseup',fnUp);
			function fnUp() {
				that.up(fnMove,fnUp);
			}
		},
		move: function (ev) {
			var l = ev.pageX - this.disX,
				t = ev.pageY - this.disY;
			if ( l<0 ) {
				l = 0;
			} else if (l>this.W - this.offsetWidth) {
				l=this.W - this.offsetWidth;
			}
			if ( t<0 ) {
				t=0;
			} else if (t>this.H - this.offsetHeight) {
				t=this.H - this.offsetHeight;
			}
			this.obj.style.left = l+'px';
			this.obj.style.top = t+'px';
		},
		up: function (fnMove,fnUp) {
			this.settings.fnUp();
			document.removeEventListener('mousemove',fnMove);
			document.removeEventListener('mouseup',fnUp);
		}
	}
	
	var div1 = new Drag('box1');
	div1.init();
	
	var div2 = new Drag('box2');
	div2.init({
		fnDown:function(){
			document.getElementById('box2').style.backgroundColor = 'red';
		}
	});
	
	var div3 = new Drag('box3');
	div3.init({
		fnUp:function(){
			document.getElementById('box3').style.backgroundColor = 'yellow';
		}
	});
	
	var div4 = new Drag('box4');
	div4.init({
		fnDown:function(){
			document.getElementById('box2').style.backgroundColor = '';
		},
		fnUp:function(){
			document.getElementById('box3').style.backgroundColor = '';
		}
	});
	
	
	
	//封装函数: 深度克隆 obj1(空对象),obj2(被克隆对象)
	function extend(obj1,obj2) {
		for ( var attr in obj2 ) {
			if ( typeof obj2[attr] == 'object' ) {
				var o = !!obj2[attr].push? []: {};
				extend(o,obj2[attr]);
				obj1[attr] = o;
			} else {
				obj1[attr] = obj2[attr];
			}
		}
	}
})()
</script>
</html>
