<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
<style>
html,
body {
	width: 100%;
	height: 100%;
}
body,
p {
	margin: 0;
}
ul {
	margin: 0;
	padding: 0;
	list-style: none;
}
a {
	text-decoration: none;
}
#folder {
	width: 100%;
	height: 100%;
}
.fold1 header {
	padding: 20px;
	height: 50px;
	background-color: #eee;
}
.fold1 header p {
	padding-top: 20px;
	font: 12px/16px "宋体";
	height: 20px;
}
.fold1 header a {
	color: #666;
}
.fold1 ul {
	overflow: hidden;
	padding: 10px 30px;
}
.fold1 li {
	position: relative;
	float: left;
	margin: 10px;
	width: 100px;
	height: 100px;
	text-align: center;
	border: 1px solid transparent;
}
.fold1 input[type="checkbox"] {
	position: absolute;
	top: 0;
	left: 0;
}
.fold1 ul a {
	position: absolute;
	bottom: 0;
	left: 0;
	height: 76px;
	width: 100px;
}
.fold1 ul p {
	height: 30px;
	font: 14px/30px "宋体";
	white-space: nowrap;
	text-overflow: ellipsis;
	overflow: hidden;
}
.fold1 a input {
	box-sizing: border-box;
	height: 30px;
	width: 100%;
	border: 1px solid #898989;
	font: 14px/30px "宋体";
	text-align: center;
}
.active {
	background-color: #cce8ff;
	border: 1px solid #99d1ff;
}
.show {
	display: block;
}
.hid {
	display: none;
}
</style>
</head>
<body>
	<div id="folder">
		<section class="fold1">
			<header>
				<input type="button" value="新建" />
				<input type="button" value="删除" />
				<p><!--<a href="javascript:;">第一级</a>--></p>
			</header>
			<ul></ul>
		</section>
	</div>
<script>
/*
	上下级切换：
		1. 页面展示
		2. 存储数据
				id:他父级的pid+index;
					id是唯一的
				
				pid:是他父级的id。
 */
var oFold = document.getElementById('folder');

var oHead = oFold.getElementsByTagName('header')[0];
var oheadP = oHead.getElementsByTagName('p')[0];
var oCreatBtn = oHead.getElementsByTagName('input')[0];
var oRemoveBtn = oHead.getElementsByTagName('input')[1];
var arrData = [];

var oUl = oFold.getElementsByTagName('ul')[0];

fold(0,1,'.');



function fold(pid,id,parName) {
	arrData.push({'pid':pid,'id':id});
	var arrLi = [];
	var index = 0;
	var a = document.createElement('a');
	a.href = 'javascript:;';
	a.innerHTML = parName;
	a.index = id;//a对应的是这个菜单的id
	
	
	//点击导航，返回父级菜单
	a.onclick = function (){
		var n = findSubscript(pid,id);
		arrData[n].child = arrLi;
		oUl.innerHTML = '';
		for ( var i=0; i<arrData.length; i++ ) {
			if ( arrData[i].id == this.index ) {
				for ( var j=0; j<arrData[i].child.length; j++ ) {
					oUl.appendChild(arrData[i].child[j]);
				}
			}
		}
	}
	oheadP.appendChild(a);
	
	oCreatBtn.onclick = creatFold;
	function creatFold() {
		var li = document.createElement('li');
		var inputCheck = document.createElement('input');
		li.index = index;
		inputCheck.type = 'checkbox';
		inputCheck.className = 'hid';
		
		li.onclick = function () {
			inputCheck.checked = !inputCheck.checked;
			inputCheck.className = 'show';
			this.className = 'active';
		}
		li.onmouseover = function () {
			inputCheck.className = 'show';
			this.className = 'active';
		}
		li.onmouseout = function () {
			if ( inputCheck.checked ) {
				inputCheck.className = 'show';
				this.className = 'active';
			} else {
				inputCheck.className = 'hid';
				this.className = '';
			}
		}
		inputCheck.onclick = function (ev) {
			var ev = ev || event;
			ev.cancelBubble = true;
		}
		
		var a = document.createElement('a');
		var img = document.createElement('img');
		var p = document.createElement('p');
		inputText = document.createElement('input');
		img.src = 'img14/0.png';
		inputText.type = 'text';
		inputText.className = 'hid';
		p.innerHTML = getName();
		
		
		inputText.onclick = function(ev){
			var ev = ev || event;
			ev.cancelBubble = true;
		}
		p.onclick = function (ev) {
			this.className = 'hid';
			this.nextElementSibling.className = 'show';
			this.nextElementSibling.value = this.innerHTML;
			this.nextElementSibling.focus();
			this.nextElementSibling.select();
			var ev = ev || event;
			ev.cancelBubble = true;
		}
		li.ondblclick = function () {
			var n = findSubscript(pid,id);
			arrData[n].child = arrLi;
			oUl.innerHTML = '';
			idNew = id + '' + this.index;
			fold(id,idNew,'/'+p.innerHTML);
		}
		a.appendChild(img);
		a.appendChild(p);
		a.appendChild(inputText);
		li.appendChild(inputCheck);
		li.appendChild(a);
		arrLi.push(li);
		oUl.appendChild(li);
		inputText.focus();
		index++;
	}
	//删除文件夹
	oRemoveBtn.onclick = removeFold;
	function removeFold() {
		var aLi = oUl.children;
		for ( var i=aLi.length-1; i>=0; i-- ) {
			
			var inputCheck = aLi[i].getElementsByTagName('input')[0];
			if ( inputCheck.checked ) {
				var n = arrLi.indexOf(aLi[i]);
				arrLi.splice(n,1);
				oUl.removeChild(aLi[i]);
			}
		}
	}
	function getName() {
		var arr = [];
		var aLi = oUl.children;
		for ( var i=0; i<aLi.length; i++ ) {
			var name = aLi[i].getElementsByTagName('p')[0].innerHTML;
			if ( name.substr(0,5) == '新建文件夹' && !isNaN(name.substring(5)) || name == '新建文件夹' ) {
				var n = isNaN(parseInt(name.substring(5)))? 0 : parseInt(name.substring(5))-1;
				arr[n] = name;
			}
		}
		if ( !arr[0] ) {
			return '新建文件夹';
		} else {
			for ( var i=0; i<arr.length; i++ ) {
				if ( !arr[i] ) {
					return '新建文件夹' + (i+1);
				}
			}
			return '新建文件夹' + (arr.length + 1);
		}
		
	}
	//点击文档保存修改文件名
	document.onclick = function () {
		var aLi = oUl.children;
		if ( aLi ) {
			for ( var i=0; i<aLi.length; i++ ) {
				var p = aLi[i].getElementsByTagName('p')[0];
				if ( p.className == 'hid' ) {
					var ipt = p.nextElementSibling;
					if ( ipt.value.trim() == '' ) {
						ipt.className = 'hid';
						p.className = 'show';
						return;
					} else {
						if ( hasName(ipt.value) ) {
							p.innerHTML = ipt.value;
							p.className = 'show';
							ipt.className = 'hid';
						} else {
							ipt.focus();
							ipt.select();
							alert('名字重复了');
							return;
						}
					}
				}
			}
		}
	}
	function hasName(name){
		var aLi = oUl.children;
		if ( aLi ) {
			for ( var i=0; i<aLi.length; i++ ) {
				var p = aLi[i].getElementsByTagName('p')[0];
				if ( p.innerHTML == name ) {
					return false;
				}
			}
		}
		return true;
	}
}
function findSubscript(pid,id) {
	for ( var i=0; i<arrData.length; i++ ) {
		if ( arrData[i].pid == pid && arrData[i].id == id ) {
			return i;
		}
	}
}


</script>
</body>
</html>
